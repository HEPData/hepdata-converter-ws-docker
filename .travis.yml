services:
- docker

language: python

python:
- '3.8'

env:
  global:
  - IMAGE_NAME=hepdata-converter-ws
  - IMAGE_NAME_REMOTE=hepdata/hepdata-converter-ws
  - DOCKER_USERNAME=hepdata
  - secure: "cznaQ13/wdbYXUphwQ1irP2AjJo2Ie7Iva7qVux+s3+q1mFnaFVJ8MAtc9W5TTal6MDouNfmOI7KwMoKZ5esRYx7ezXGVFoKBxg7NEOk/TWxLWm9YUNZMQ1F2WGN68hsWn71mMkDKydQInQGu95LCbjVYB/zDSMVGGRvjZ2tisPf5d9K73HbKaySisNH/jAbZt0RdZWkRbaOUX0zvo+McsxJ/lOEUxudv3rn0ranGJnkWKvpmu35x7Rw+voLv79/M3rgq/k5zBknxsR2d5WfWJmUtmXML3w5ppZq3n7eAepZkmCL16F4Hez1HJ3Qnv58Og4dHMhssBdkKasUJXHhzb3/DmrMdeGzMKyDPpRE3JtLIk6OfV3ntZ69u9KqYo6R1wjJZM+79a0SX7PSt7yGQn7GewGfCqKNPZbJCceD1EvgxViAZ7ZGHmwvVuyTCcR6vXmLoB7k6f6xkzuu6cxd9+fE3C4WYowGynBp21RTB5HADMcFOLBqTqZRs6cSPtyEYsCj2fkX+UzjyfyiJHj0QPIe6zPwlOxeSua+ZucrbbtjGwLAySIFEw3v3zmuIXw4lEJAyvn0Qi0SYcpnvaLRXDs9KdQ20jTMR6LfxljoZoUajDuRIO0gjfKCmnwcLG5L23MCDWS4cvRkSoqOFLFWxsMBhr66xpN9DQKkYszr9t4="

cache:
- docker

install:
- echo "creating $IMAGE_NAME image..."

script:
- docker build -t $IMAGE_NAME .

deploy:
  skip_cleanup: true
  provider: script
  script: bash docker_push
  on:
    repo: HEPData/hepdata-converter-ws-docker
    all_branches: true
    condition: $TRAVIS_BRANCH == "master" || -n $TRAVIS_TAG
